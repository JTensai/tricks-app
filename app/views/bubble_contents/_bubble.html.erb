<% text_default = "locals: {link:, image:, color:, text:, text_color:, show_button:}" %>
<% color_default = "333333" %>
<% text_color_default = "ffffff" %>
<% link_default = "javascript:void(0);" %>
<% show_button_default = false %>
<% data_toggle_default = "" %>
<% font_size_default = "40" %>
<% text_border_color_default = "555" %>
<% text_border_size_default = "1" %>


<% if defined? given_bubble #check if a bubble_content object was passed in %>
    <% bubble = given_bubble %>
<% elsif defined? @bubble_content #check if we are in the "show" view for bubble_content %>
    <% bubble = @bubble_content %>
<% else #check to see if it is a full custom bubble and use passed in locals or defaults %>
    <% bubble = BubbleContent.create() %>
    <% bubble.text = (defined? text) ? text : text_default %>
    <%# bubble.font_size = (defined? font_size) ? font_size : font_size_default %>
    <% bubble.color = (defined? color) ? color : color_default %>
    <% bubble.text_color = (defined? text_color) ? text_color : text_color_default %>
    <% bubble.link = (defined? link) ? link : link_default %>
    <% bubble.image = (defined? image) ? image : "" %>
    <% bubble.show_button = (defined? show_button) ? show_button : show_button_default %>
<% end %>

<% if bubble.text.blank? %>
    <% text = text_default %>
<% else %>
    <% text = bubble.text %>
<% end %>

<% if !defined? font_size %>
    <% font_size = font_size_default %>
<% end %>
<% if !defined? text_border_color %>
    <% text_border_color = text_border_color_default %>
<% end %>
<% if !defined? text_border_size %>
    <% text_border_size = text_border_size_default %>
<% end %>

<% if bubble.color.blank? %>
    <% color = color_default.gsub('#', '') %>
<% else %>
    <% color = bubble.color.gsub('#', '') %>
<% end %>

<%# if there is no image, set the background color %>
<% if !bubble.image.blank? %>
    <% image = bubble.image %>
<% end %>

<% if bubble.text_color.blank? %>
    <% text_color = text_color_default.gsub('#', '') %>
<% else %>
    <% text_color = bubble.text_color.gsub('#', '') %>
<% end %>

<% link = link_default %>
<% data_toggle = data_toggle_default %>
<% if !bubble.link.blank? %>
    <% if bubble.link.include? "modal" %>
        <% data_toggle = bubble.link %>
    <% else %>
        <% link = bubble.link %>
    <% end %>
<% end %>




<div style="width: 100%; position: relative; padding-top: 100%; background-color: #<%= color %>; background-image: url(<%= image %>); background-size: contain; border-radius: 50%; box-shadow: 0px 0px 40px #222;">
    <%= link_to "", link, "data-toggle": data_toggle, style: "display: block; position: absolute; top: 0; bottom: 0; left: 0; right: 0;" %>
    <div style="position: absolute; width: 100%; top: 50%; transform: translate(0, -50%); text-align: center; padding: 10px; pointer-events: none;">
        <%= link_to text, link, "data-toggle": data_toggle, style: "color: #" + text_color + ";font-size: " + font_size + "px; text-shadow: -"+text_border_size+"px "+text_border_size+"px #"+text_border_color+", "+text_border_size+"px "+text_border_size+"px #"+text_border_color+", "+text_border_size+"px -"+text_border_size+"px #"+text_border_color+", -"+text_border_size+"px -"+text_border_size+"px #"+text_border_color+";" %>
    </div>
    <% if bubble.show_button %>
        <%= link_to text, link, class: "button", "data-toggle": data_toggle, style: "border-radius: 5px; margin-top: 15px; font-size: 20px; color: #fff;; box-shadow: 2px 2px 10px #222;" %>
    <% end %>
</div>